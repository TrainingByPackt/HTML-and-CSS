<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Exercise 2: Custom Element with Attributes</title>
        <style>
            .new-post::before {
                font-weight: bold;
                content: "‚è∞ NEW! ‚è∞";
            }
        </style>
    </head>
    <body>
        <main class="blog-posts">
            <article>
                <blog-headline id="cat-headline" type="cats" newpost>Blog Post About Kittens</blog-headline>   
                <div class="test-ui">
                    <button id="swap-type-1">Swap type attribute</button>
                    <button id="swap-newpost-1">Swap newpost attribute</button>
                    <button id="toggle-connect-1">Toggle connection</button>
                </div>            
            </article>
            <article>
                <blog-headline type="dogs">Blog Post About Puppies</blog-headline>   
            </article>
        </main>
        <script>
            class BlogHeadline extends HTMLElement {
                static get observedAttributes() {
                    return ['type', 'newpost'];
                }

                constructor() {
                    super();
                    this._heading = this.textContent;
                    console.log(this._heading);
                }

                connectedCallback() {
                  console.log("Connected");
                  this.setIcon(this.type);
                }

                disconnectedCallback() {
                    console.log("Disconnected");
                }

                attributeChangedCallback(name, oldValue, newValue) {
                    if (oldValue === newValue) { return; }
                    console.log(name, newValue);
                    switch(name) {
                        case 'type':
                            this.setIcon(this.type);
                            break;
                        case 'newpost':
                            this.setIsNewPostIcon(this.newpost);
                            break;
                    }
                }

                get heading() {
                    return this._heading;
                }

                get type() {
                    return this.getAttribute("type");
                }

                set type(newValue) {
                    this.setAttribute("type", newValue);
                    this.setIcon(this.type);
                }

                get newpost() {
                    return this.hasAttribute("newpost");
                }

                set newpost(newValue) {
                    if (newValue) { 
                        this.setAttribute("newpost", '');
                    }
                    else { 
                        this.removeAttribute("newpost"); 
                    }
                    this.setIsNewPostIcon(this.newpost);
                }

                setIcon(type) {
                    switch(type) {
                        case "cats":
                            this.textContent = "üê± " + this.heading + " üê±";
                            break;
                        case "dogs":
                            this.textContent = "üê∂ " + this.heading + " üê∂";
                            break;
                    }
                }

                setIsNewPostIcon(isNewPost) {
                    if (isNewPost) {
                        this.classList.add("new-post");
                    }
                    else {
                        this.classList.remove("new-post");
                    }
                }
            }
            window.customElements.define("blog-headline", BlogHeadline);

            const headline = document.querySelector('blog-headline');
            const headlineParent = headline.parentElement;
            const swapTypeButton = document.getElementById('swap-type-1');
            const swapNewpostButton = document.getElementById('swap-newpost-1');
            const toggleConnectionButton = document.getElementById('toggle-connect-1');

            swapTypeButton.addEventListener('click', function() {
                const type = headline.getAttribute('type');
                headline.setAttribute('type', type === 'cats' ? 'dogs' : 'cats')
            });

            swapNewpostButton.addEventListener('click', function() {
                const newpost = headline.hasAttribute('newpost');
                if (newpost) {
                    headline.removeAttribute('newpost');
                }
                else {
                    headline.setAttribute('newpost', '');
                }
            });

            toggleConnectionButton.addEventListener('click', function() {
                if (headline.parentElement) {
                    headlineParent.removeChild(headline);
                }
                else {
                    headlineParent.insertBefore(headline, headlineParent.firstChild);
                }
            });
        </script>
    </body>
</html>